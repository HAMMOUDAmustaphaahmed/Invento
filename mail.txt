

# Configuration pour Mailtrap (vous pouvez utiliser Gmail ou un autre service SMTP si vous préférez)
app.config['MAIL_SERVER'] = 'smtp.mailtrap.io'
app.config['MAIL_PORT'] = 587
app.config['MAIL_USE_TLS'] = True
app.config['MAIL_USE_SSL'] = False
app.config['MAIL_USERNAME'] = '7d100102d1a11a1b873e822800d52d6d'  # API Key Mailtrap ou votre email Gmail
app.config['MAIL_PASSWORD'] = 'Draft24.2024'  # Password Mailtrap ou votre mot de passe Gmail
app.config['MAIL_DEFAULT_SENDER'] = 'gestion.stock.benetton@gmail.com'  # Adresse de l'expéditeur
app.config['MAIL_SUPPRESS_SEND'] = False  # Pour activer l'envoi des emails



# Initialisation de Flask-Mail
mail = Mail(app)


import mailtrap as mt

mail = mt.Mail(
    sender=mt.Address(email="hello@demomailtrap.com", name="Mailtrap Test"),
    to=[mt.Address(email="gestion.stock.benetton@gmail.com")],
    subject="You are awesome!",
    text="Congrats for sending test email with Mailtrap!",
    category="Integration Test",
)

client = mt.MailtrapClient(token="7d100102d1a11a1b873e822800d52d6d")
response = client.send(mail)

print(response)



@app.route('/send-test-email')
def send_test_email():
    try:
        msg = Message('Test Email from Flask',
                      recipients=['ust4@benettongroup.org'])  # Destinataire
        msg.body = 'This is a test email sent from a Flask web application using Flask-Mail.'
        
        # Envoi de l'email
        mail.send(msg)
        return 'Email sent successfully!'
    except Exception as e:
        return f'An error occurred: {str(e)}'