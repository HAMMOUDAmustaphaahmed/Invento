<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
 <!-- Favicon -->
 <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">

	<!-- Boxicons -->
	<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
	<!-- My CSS -->
	<link rel="stylesheet" href="style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


	<title>INVENTO</title>
</head>
<body>


	<!-- SIDEBAR -->
	<section id="sidebar">
		<a href="#" class="brand">
			<nav>
                
                    <img src="{{ url_for('static', filename='invengo.png') }}" alt="Invengo Logo" style="width: 150px;">
                
            </nav>
            <style>
                nav img {
                max-width: 150px;  /* Ajustez selon vos besoins */
                max-height: 150px;
                margin-top: 20px;
                margin-bottom: -50px;
                margin-left: 10px;
                margin-right: 10px;}
            </style>
		</a>
		<ul class="side-menu top">
			<!-- Trigger Button -->
<!-- Trigger pour le modal -->
<!-- Ajout d'Article -->


			<li id="my-store-li">
                <a href="#">
                    <i class='bx bxs-shopping-bag-alt'></i>
                    <span class="text">Magasin</span>
                </a>
            </li>
			
			
            
            <div id="articlesModal" style="display: none;">
                <div class="modal-content">
                    <span class="close-button">&times;</span>
                    <h2>Store Articles</h2>
                    <table id="articles-table">
                        <thead>
                            <tr>
                                <th>Code Article</th>
                                <th>Libelle Article</th>
                                <th>Prix Achat</th>
                                <th>Emplacement</th>
                                <th>Quantité</th>
                                <th>Fournisseur</th>
                            </tr>
                        </thead>
                        <tbody id="articles-body">
                            <!-- Articles will be populated here -->
                        </tbody>
                    </table>
                    <div id="pagination">
                        <button id="prev-button" >Précédent</button>
                        <button id="next-button" >Suivant</button>
                    </div>
                </div>
            </div>
            

<!-- Modal CSS Styles -->
<style>
    #articlesModal {
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background-color: white;
        padding: 20px;
        border-radius: 5px;
        width: 80%;
        max-width: 600px;
        overflow: auto;
    }

    .close-button {
        float: right;
        cursor: pointer;
        font-size: 20px;
    }

    #articles-table {
        width: 100%;
        border-collapse: collapse;
    }

    #articles-table th, #articles-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }

    #articles-table th {
        background-color: #f2f2f2;
        position: sticky;
        top: 0;
        z-index: 10;
    }

    #pagination {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
    }

    #prev-button, #next-button {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        background-color: #007bff; /* Couleur de fond */
        color: white; /* Couleur du texte */
    }

    #prev-button:disabled, #next-button:disabled {
        background-color: transparent; /* Couleur de fond transparente */
        color: #ccc; /* Couleur du texte grisé */
        cursor: not-allowed; /* Changement du curseur pour indiquer que le bouton est désactivé */
    }
</style>


<!-- jQuery for AJAX and modal logic -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        let currentPage = 1;
        const articlesPerPage = 5;
        let articlesData = []; // Pour stocker tous les articles récupérés

        // Fonction pour afficher les articles de la page actuelle
        function displayArticles() {
            const startIndex = (currentPage - 1) * articlesPerPage;
            const endIndex = startIndex + articlesPerPage;

            // Vider le corps du tableau
            $('#articles-body').empty();

            // Afficher les articles pour la page actuelle
            const currentArticles = articlesData.slice(startIndex, endIndex);
            if (currentArticles.length === 0) {
                $('#articles-body').append('<tr><td colspan="6">Aucun article trouvé</td></tr>');
            } else {
                currentArticles.forEach(function(article) {
                    $('#articles-body').append(
                        `<tr>
                            <td>${article.code_article}</td>
                            <td>${article.libelle_article}</td>
                            <td>${article.prix_achat}</td>
                            <td>${article.emplacement}</td>
                            <td>${article.quantite}</td>
                            <td>${article.fournisseur}</td>
                        </tr>`
                    );
                });
            }

            // Gérer l'affichage des boutons de pagination
            $('#prev-button').prop("disabled", currentPage === 1); // Désactiver le bouton précédent si à la première page
            $('#next-button').prop("disabled", endIndex >= articlesData.length); // Désactiver le bouton suivant si à la dernière page
        }

        // Quand le 'My Store' list item est cliqué
        $('#my-store-li').on('click', function() {
            // Récupérer les articles depuis le serveur
            $.get('/get_articles', function(data) {
                articlesData = data; // Stocker les articles récupérés
                currentPage = 1; // Réinitialiser la page actuelle
                displayArticles(); // Afficher les articles
                $('#articlesModal').show();
            }).fail(function(xhr, status, error) {
                console.error("Erreur lors de la récupération des articles :", status, error);
            });
        });

        // Navigation vers la page suivante
        $('#next-button').on('click', function() {
            if ((currentPage * articlesPerPage) < articlesData.length) {
                currentPage++;
                displayArticles();
            }
        });

        // Navigation vers la page précédente
        $('#prev-button').on('click', function() {
            if (currentPage > 1) {
                currentPage--;
                displayArticles();
            }
        });

        // Fermer le modal
        $('.close-button').on('click', function() {
            $('#articlesModal').hide();
        });
    });
</script>



			


<!-- Modal styles (reuse the same CSS you already have) -->
<style>
    /* Modal styles */
    #userModal {
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 1200px;
        height: 800px;
        background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background-color: white;
        padding: 20px;
        border-radius: 5px;
        width: 80%;
        max-width: 600px;
        overflow: auto;
    }

    .close-button {
        float: right;
        cursor: pointer;
        font-size: 20px;
    }

    /* Table styles */
    #user-table {
        width: 100%;
        border-collapse: collapse;
    }

    #user-table th, #user-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }

    #user-table th {
        background-color: #f2f2f2;
        position: sticky;
        top: 0;
        z-index: 10;
    }
</style>



		
		
		
			<li id="add-demande_achat">
                <a href="#">
                    <i class='bx bx bxs-bookmark-plus'></i>
                    <span class="text">demande achat</span>
                </a>
            </li>
            <li id="add-demande_vente">
                <a href="#">
                    <i class='bx bx bxs-bookmark-minus'></i>
                    <span class="text">demande vente</span>
                </a>
            </li>
            
			<li>
				<a href="/logout" class="logout">
					<i class='bx bxs-log-out-circle' ></i>
					<span class="text" >Logout</span>
				</a>
                
			</li>
		</ul>
	</section>
	<!-- SIDEBAR -->



	<!-- CONTENT -->
	<section id="content">
		<!-- NAVBAR -->
		<nav>
			<i class='bx bx-menu' ></i>
			<a href="#" class="nav-link"></a>
            <form id="search-form" action="#" method="POST">
                <div class="form-input">
                    <input type="search" id="search-query" name="search_query" placeholder="Search..." required>
                    <button type="submit" class="search-btn"><i class='bx bx-search'></i></button>
                </div>
            </form>
            
            <!-- Modal -->
            <div id="searchModal" class="modal">
                <div class="modal-content">
                    
                    <div id="modal-body">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="date-filter-form" method="POST" action="/search_articles">
                            <div class="form-group">
                                <label for="date-debut">Date de début :</label>
                                <div class="input-group">
                                    <input type="date" id="date-debut" name="date_debut" class="form-control">
                                    <div class="input-group-append">
                                        <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="date-fin">Date de fin :</label>
                                <div class="input-group">
                                    <input type="date" id="date-fin" name="date_fin" class="form-control">
                                    <div class="input-group-append">
                                        <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Appliquer les filtres</button>
                        </form>
                        <table id="results-table" class="responsive-table">
                            <thead>
                                <tr>
                                    <th>Code Article</th>
                                    <th>Libelle</th>
                                    <th>Prix Achat</th>
                                    <th>Quantite</th>
                                    <th>Fournisseur</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Les résultats seront insérés ici -->
                            </tbody>
                        </table>
                        <button id="export-csv-btn" class="export-btn">Exporter en CSV</button>
                        <button id="print-btn">Imprimer</button>
            
            
                    </div>
                </div>
            </div>
            <style>
                /* Modal */
            .modal {
                display: none; /* Le modal est masqué par défaut */
                position: fixed;
                z-index: 1;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: auto;
                background-color: rgba(0, 0, 0, 0.4);
            }
            
            .modal-content {
                background-color: #fefefe;
                margin: 15% auto;
                padding: 20px;
                border: 1px solid #888;
                width: 80%;
            }
            
            .close {
                color: #000000;
                float: right;
                font-size: 28px;
                font-weight: bold;
            }
            
            .close:hover, .close:focus {
                color: rgb(255, 0, 0);
                text-decoration: none;
                cursor: pointer;
            }
            
            /* Style spécifique pour le tableau dans le modal */
            .responsive-table {
                width: 100%;
                border-collapse: collapse;
                margin: 25px 0;
                font-size: 18px;
                text-align: left;
            }
            
            .responsive-table th, .responsive-table td {
                padding: 12px 15px;
                border: 1px solid #ddd;
            }
            
            .responsive-table th {
                background-color: #f2f2f2;
            }
            
            .responsive-table tr:nth-child(even) {
                background-color: #f9f9f9;
            }
            
            </style>
            
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                console.log("Page loaded");
            
                var modal = document.getElementById("searchModal");
                var closeBtn = document.querySelector('.close');
            
                // Ne pas ouvrir automatiquement le modal
                modal.style.display = "none";
            
                // Fonction pour gérer la soumission du formulaire de recherche
                document.getElementById("search-form").onsubmit = function(event) {
                    event.preventDefault();  // Empêche la soumission classique du formulaire
            
                    var searchQuery = document.getElementById("search-query").value;
                    var tableBody = document.querySelector("#results-table tbody");
            
                    // Vérifier que le champ de recherche n'est pas vide
                    if (searchQuery.trim() === "") {
                        console.log("Search query is empty, modal won't open");
                        return; // Ne pas ouvrir le modal si la requête de recherche est vide
                    }
            
                    fetch('/search_articles', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: 'search_query=' + encodeURIComponent(searchQuery),
                    })
                    .then(response => response.json())
                    .then(data => {
                        tableBody.innerHTML = ''; // Efface les résultats précédents
            
                        if (data.articles.length > 0) {
                            data.articles.forEach(article => {
                                var row = document.createElement('tr');
                                row.innerHTML = `
                                    <td data-label="Code Article">${article.code_article}</td>
                                    <td data-label="Libelle">${article.libelle_article}</td>
                                    <td data-label="Prix Achat">${article.prix_achat}</td>
                                    <td data-label="Quantite">${article.quantite}</td>
                                    <td data-label="Fournisseur">${article.fournisseur}</td>
                                `;
                                tableBody.appendChild(row);
                            });
                        } else {
                            tableBody.innerHTML = '<tr><td colspan="5">No articles found</td></tr>';
                        }
            
                        // Afficher le modal une fois les résultats obtenus
                        modal.style.display = "block";
                    });
                };
            
                // Fermer le modal quand on clique sur le bouton de fermeture
                closeBtn.onclick = function() {
                    console.log("Modal closed");
                    modal.style.display = "none";
                };
            
                // Fermer le modal si on clique en dehors de celui-ci
                window.onclick = function(event) {
                    if (event.target == modal) {
                        modal.style.display = "none";
                    }
                };
            
                // Fonction pour exporter les résultats du tableau en fichier CSV
                document.getElementById("export-csv-btn").onclick = function() {
                var table = document.getElementById("results-table");
                var rows = Array.from(table.querySelectorAll('tr'));
            
                // Créer une feuille de calcul
                var workbook = XLSX.utils.book_new();
                var worksheet_data = [];
            
                // Extraire les en-têtes du tableau (th)
                var headers = Array.from(rows[0].querySelectorAll('th')).map(header => header.textContent.trim());
                worksheet_data.push(headers); // Ajouter les en-têtes comme première ligne
            
                // Extraire les données du tableau (td)
                rows.slice(1).forEach(row => {
                    var rowData = Array.from(row.querySelectorAll('td')).map(cell => cell.textContent.trim());
                    worksheet_data.push(rowData); // Ajouter les données de chaque ligne
                });
            
                // Créer une feuille dans le workbook avec les données du tableau
                var worksheet = XLSX.utils.aoa_to_sheet(worksheet_data);
                XLSX.utils.book_append_sheet(workbook, worksheet, "Articles");
            
                // Exporter le fichier Excel
                XLSX.writeFile(workbook, 'resultats_recherche_articles.xlsx');
            };
                // Fonction pour imprimer le tableau
                document.getElementById("print-btn").onclick = function() {
                    var table = document.getElementById("results-table").outerHTML;
            
                    // Ouvrir une nouvelle fenêtre pour l'impression
                    var printWindow = window.open('', '', 'width=800,height=600');
                    printWindow.document.write('<html><head><title>Imprimer les résultats</title>');
                    printWindow.document.write('<style>table { width: 100%; border-collapse: collapse; } th, td { border: 1px solid black; padding: 8px; text-align: left; } </style>');
                    printWindow.document.write('</head><body>');
                    printWindow.document.write(table); // Insérer le tableau dans la nouvelle fenêtre
                    printWindow.document.write('</body></html>');
                    printWindow.document.close(); // Fermer le document pour qu'il soit prêt à être imprimé
                    printWindow.focus();
                    printWindow.print(); // Ouvrir la boîte de dialogue d'impression
                    printWindow.close(); // Fermer la fenêtre d'impression après l'impression
                };
                // Fermer le modal si on clique en dehors de celui-ci
                window.onclick = function(event) {
                    if (event.target == modal) {
                        modal.style.display = "none";
                    }
                };
            });
            
            </script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script><form id="search-form" action="#" method="POST">
                
            </form>
            
            <!-- Modal -->
            <div id="searchModal" class="modal">
                <div class="modal-content">
                    
                    <div id="modal-body">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="date-filter-form" method="POST" action="/search_articles">
                            <div class="form-group">
                                <label for="date-debut">Date de début :</label>
                                <div class="input-group">
                                    <input type="date" id="date-debut" name="date_debut" class="form-control">
                                    <div class="input-group-append">
                                        <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="date-fin">Date de fin :</label>
                                <div class="input-group">
                                    <input type="date" id="date-fin" name="date_fin" class="form-control">
                                    <div class="input-group-append">
                                        <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Appliquer les filtres</button>
                        </form>
                        <table id="results-table" class="responsive-table">
                            <thead>
                                <tr>
                                    <th>Code Article</th>
                                    <th>Libelle</th>
                                    <th>Prix Achat</th>
                                    <th>Quantite</th>
                                    <th>Fournisseur</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Les résultats seront insérés ici -->
                            </tbody>
                        </table>
                        <button id="export-csv-btn" class="export-btn">Exporter en CSV</button>
                        <button id="print-btn">Imprimer</button>
            
            
                    </div>
                </div>
            </div>
            <style>
                /* Modal */
            .modal {
                display: none; /* Le modal est masqué par défaut */
                position: fixed;
                z-index: 1;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: auto;
                background-color: rgba(0, 0, 0, 0.4);
            }
            
            .modal-content {
                background-color: #fefefe;
                margin: 15% auto;
                padding: 20px;
                border: 1px solid #888;
                width: 80%;
            }
            
            .close {
                color: #000000;
                float: right;
                font-size: 28px;
                font-weight: bold;
            }
            
            .close:hover, .close:focus {
                color: rgb(255, 0, 0);
                text-decoration: none;
                cursor: pointer;
            }
            
            /* Style spécifique pour le tableau dans le modal */
            .responsive-table {
                width: 100%;
                border-collapse: collapse;
                margin: 25px 0;
                font-size: 18px;
                text-align: left;
            }
            
            .responsive-table th, .responsive-table td {
                padding: 12px 15px;
                border: 1px solid #ddd;
            }
            
            .responsive-table th {
                background-color: #f2f2f2;
            }
            
            .responsive-table tr:nth-child(even) {
                background-color: #f9f9f9;
            }
            
            </style>
            
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                console.log("Page loaded");
            
                var modal = document.getElementById("searchModal");
                var closeBtn = document.querySelector('.close');
            
                // Ne pas ouvrir automatiquement le modal
                modal.style.display = "none";
            
                // Fonction pour gérer la soumission du formulaire de recherche
                document.getElementById("search-form").onsubmit = function(event) {
                    event.preventDefault();  // Empêche la soumission classique du formulaire
            
                    var searchQuery = document.getElementById("search-query").value;
                    var tableBody = document.querySelector("#results-table tbody");
            
                    // Vérifier que le champ de recherche n'est pas vide
                    if (searchQuery.trim() === "") {
                        console.log("Search query is empty, modal won't open");
                        return; // Ne pas ouvrir le modal si la requête de recherche est vide
                    }
            
                    fetch('/search_articles', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: 'search_query=' + encodeURIComponent(searchQuery),
                    })
                    .then(response => response.json())
                    .then(data => {
                        tableBody.innerHTML = ''; // Efface les résultats précédents
            
                        if (data.articles.length > 0) {
                            data.articles.forEach(article => {
                                var row = document.createElement('tr');
                                row.innerHTML = `
                                    <td data-label="Code Article">${article.code_article}</td>
                                    <td data-label="Libelle">${article.libelle_article}</td>
                                    <td data-label="Prix Achat">${article.prix_achat}</td>
                                    <td data-label="Quantite">${article.quantite}</td>
                                    <td data-label="Fournisseur">${article.fournisseur}</td>
                                `;
                                tableBody.appendChild(row);
                            });
                        } else {
                            tableBody.innerHTML = '<tr><td colspan="5">No articles found</td></tr>';
                        }
            
                        // Afficher le modal une fois les résultats obtenus
                        modal.style.display = "block";
                    });
                };
            
                // Fermer le modal quand on clique sur le bouton de fermeture
                closeBtn.onclick = function() {
                    console.log("Modal closed");
                    modal.style.display = "none";
                };
            
                // Fermer le modal si on clique en dehors de celui-ci
                window.onclick = function(event) {
                    if (event.target == modal) {
                        modal.style.display = "none";
                    }
                };
            
                // Fonction pour exporter les résultats du tableau en fichier CSV
                document.getElementById("export-csv-btn").onclick = function() {
                var table = document.getElementById("results-table");
                var rows = Array.from(table.querySelectorAll('tr'));
            
                // Créer une feuille de calcul
                var workbook = XLSX.utils.book_new();
                var worksheet_data = [];
            
                // Extraire les en-têtes du tableau (th)
                var headers = Array.from(rows[0].querySelectorAll('th')).map(header => header.textContent.trim());
                worksheet_data.push(headers); // Ajouter les en-têtes comme première ligne
            
                // Extraire les données du tableau (td)
                rows.slice(1).forEach(row => {
                    var rowData = Array.from(row.querySelectorAll('td')).map(cell => cell.textContent.trim());
                    worksheet_data.push(rowData); // Ajouter les données de chaque ligne
                });
            
                // Créer une feuille dans le workbook avec les données du tableau
                var worksheet = XLSX.utils.aoa_to_sheet(worksheet_data);
                XLSX.utils.book_append_sheet(workbook, worksheet, "Articles");
            
                // Exporter le fichier Excel
                XLSX.writeFile(workbook, 'resultats_recherche_articles.xlsx');
            };
                // Fonction pour imprimer le tableau
                document.getElementById("print-btn").onclick = function() {
                    var table = document.getElementById("results-table").outerHTML;
            
                    // Ouvrir une nouvelle fenêtre pour l'impression
                    var printWindow = window.open('', '', 'width=800,height=600');
                    printWindow.document.write('<html><head><title>Imprimer les résultats</title>');
                    printWindow.document.write('<style>table { width: 100%; border-collapse: collapse; } th, td { border: 1px solid black; padding: 8px; text-align: left; } </style>');
                    printWindow.document.write('</head><body>');
                    printWindow.document.write(table); // Insérer le tableau dans la nouvelle fenêtre
                    printWindow.document.write('</body></html>');
                    printWindow.document.close(); // Fermer le document pour qu'il soit prêt à être imprimé
                    printWindow.focus();
                    printWindow.print(); // Ouvrir la boîte de dialogue d'impression
                    printWindow.close(); // Fermer la fenêtre d'impression après l'impression
                };
                // Fermer le modal si on clique en dehors de celui-ci
                window.onclick = function(event) {
                    if (event.target == modal) {
                        modal.style.display = "none";
                    }
                };
            });
            
            </script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>

<!-- JavaScript/jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>




			
			<input type="checkbox" id="switch-mode" hidden>
			<label for="switch-mode" class="switch-mode"></label>
			<a href="#" class="notification" onclick="openLowStockModal()">
                <i class='bx bxs-bell'></i>
                <span class="num" id="low-stock-count">{{ low_stock_count }}</span>
            </a>
            
            <!-- Modal HTML (initialement caché) -->
            <div id="notification-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <span class="close" onclick="closeLowStockModal()">&times;</span>
                    <h2>Articles en faible stock</h2>
                    <table id="low-stock-table">
                        <thead>
                            <tr>
                                <th>Code Article</th>
                                <th>Libellé</th>
                                <th>Quantité</th>
                                <th>Quantité Min</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Les articles en faible stock seront insérés ici dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </div>

            <script>
                function openLowStockModal() {
    // Effectuer une requête GET pour récupérer les articles en faible stock
    fetch('/get_low_stock_articles')
        .then(response => response.json())
        .then(data => {
            // Remplir le tableau avec les articles reçus
            const tableBody = document.querySelector('#low-stock-table tbody');
            tableBody.innerHTML = '';  // Vider le tableau avant de le remplir

            data.articles.forEach(article => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${article.code_article}</td>
                    <td>${article.libelle}</td>
                    <td>${article.quantite}</td>
                    <td>${article.quantite_min}</td>
                `;
                tableBody.appendChild(row);
            });

            // Afficher le modal
            document.getElementById('notification-modal').style.display = 'block';
        })
        .catch(error => console.error('Error fetching low stock articles:', error));
}

function closeLowStockModal() {
    document.getElementById('notification-modal').style.display = 'none';
}

            </script>
            
            <style>
                /* Style unique pour le modal de notification */
#notification-modal {
    display: none; /* Cacher par défaut */
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5); /* Arrière-plan sombre */
}

#notification-modal .modal-content {
    background-color: #fff;
    margin: 10% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 60%;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Ombre légère */
    border-radius: 8px; /* Coins arrondis */
}

#notification-modal .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

#notification-modal .close:hover,
#notification-modal .close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

#notification-modal h2 {
    font-size: 24px;
    margin-bottom: 20px;
    text-align: center;
}

#notification-modal table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
}

#notification-modal table th, 
#notification-modal table td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
}

#notification-modal table th {
    background-color: #f2f2f2;
    font-weight: bold;
}

#notification-modal table tr:nth-child(even) {
    background-color: #f9f9f9;
}

#notification-modal table tr:hover {
    background-color: #ddd;
}

            </style>


            <a href="#" class="notification">
				<i class='bx bxs-message' ></i>
				<span class="num">1</span>
			</a>
			
		</nav>
		<!-- NAVBAR -->

		<!-- MAIN -->
		<main>
			<div class="head-title">
				<div class="left">
					
					<ul class="breadcrumb">
						<li>
							<a href="#" >User</a>
						</li>
						<li><i class='bx bx-chevron-right' ></i></li>
						
					</ul>
				</div>
				
			</div>
            <ul class="box-info">
				<li  id="orders-list-item" style="cursor: pointer;background-color: #c3e3f0;">
                    <i class='bx bxs-bookmark-plus'></i>
                    <span class="text">
                        <h3 class="orders-count">{{ orders_count }}</h3>  <!-- Display the count here --> 
                        <p>Demandes d'Achats</p>
                    </span>
                </li>
                <div id="ordersModal" style="display: none;">
                    <div class="modal-content">
                        <span class="close-button">&times;</span>
                        <h2>Demandes d'Achats</h2>
                        <table id="orders-table">
                            <thead>
                                <tr>
                                    <th>Code Demande</th>
                                    <th>Code Article</th>
                                    <th>Libelle Article</th>
                                    <th>Quantité</th>
                                    <th>Emplacement</th>
                                    <th>Date</th>
                                    <th>Demandeur</th>
                                </tr>
                            </thead>
                            <tbody id="orders-body">
                                <!-- Orders will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                
                <script>
                $(document).ready(function() {
                    $('#orders-list-item').on('click', function() {
                        $.get('/pending_buys', function(data) {
                            console.log("AJAX Response:", data);  // Log the response data
                            $('#orders-body').empty();  // Clear previous entries
                            
                            // Check if data is empty
                            if (data.length === 0) {
                                $('#orders-body').append('<tr><td colspan="7">No pending orders found</td></tr>');
                            } else {
                                data.forEach(function(order) {
                                    $('#orders-body').append(
                                        `<tr>
                                            <td>${order.code_demande}</td>
                                            <td>${order.code_article}</td>
                                            <td>${order.libelle_article}</td>
                                            <td>${order.quantite}</td>
                                            <td>${order.emplacement}</td>
                                            <td>${new Date(order.date).toLocaleString()}</td>
                                            <td>${order.demandeur}</td>
                                        </tr>`
                                    );
                                });
                            }
                            $('#ordersModal').show();  // Show the modal
                        }).fail(function(xhr, status, error) {
                            console.error("AJAX Error:", status, error);  // Log any AJAX errors
                        });
                    });
                
                    $('.close-button').on('click', function() {
                        $('#ordersModal').hide();  // Hide the modal
                    });
                });
                </script>
                <li id="total-sales-item" style="cursor: pointer;background-color: #b2db96;">
                    <i class='bx bxs-bookmark-minus'></i>
                    <span class="text">
                        <h3 id="total-sales-amount"class="sales-count">{{ sales_count }}</h3>
                        <p>Demandes de Ventes</p>
                
                    </span>
                </li>
                
<!-- Modal structure for sales -->
<div id="salesModal" style="display: none;">
    <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2>Demandes de Ventes</h2>
        <table id="sales-table">
            <thead>
                <tr>
                    
                    <th>Code Article</th>
                    <th>Libelle Article</th>
                    <th>Quantité</th>
                    <th>Emplacement</th>
                    <th>Date</th>
                    <th>Demandeur</th>
                </tr>
            </thead>
            <tbody id="sales-body">
                <!-- Sales will be populated here -->
            </tbody>
        </table>
    </div>
</div>
<style>
#salesModal,#ordersModal {
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background-color: white;
    padding: 20px;
    border-radius: 5px;
    width: 80%;
    max-width: 600px;
    overflow: auto; /* Allow scrolling if content overflows */
}

.close-button {
    float: right;
    cursor: pointer;
    font-size: 20px;
}

#sales-table, #orders-table {
    width: 100%;
    border-collapse: collapse; /* Remove space between cells */
}

#sales-table th, #sales-table td ,#orders-table th,#orders-table td{
    padding: 12px; /* Add padding for spacing */
    text-align: left; /* Align text to the left */
    border-bottom: 1px solid #ddd; /* Add a bottom border */
}

#sales-table th ,#orders-table th {
    background-color: #f2f2f2; /* Light gray background for headers */
    position: sticky; /* Keep headers at the top */
    top: 0; /* Stick to the top */
    z-index: 10; /* Ensure headers are above the other cells */
}

</style>

<script>$(document).ready(function() {
    $('#total-sales-item').on('click', function() {
        $.get('/pending_sales', function(data) {  // Appel AJAX pour récupérer les demandes de vente
            console.log("AJAX Response:", data);  // Log the response data
            $('#sales-body').empty();  // Clear previous entries
            
            // Check if data is empty
            if (data.length === 0) {
                $('#sales-body').append('<tr><td colspan="7">No pending sales found</td></tr>');
            } else {
                data.forEach(function(sale) {
                    $('#sales-body').append(
                        `<tr>
                            
                            <td>${sale.code_article}</td>
                            <td>${sale.libelle_article}</td>
                            <td>${sale.quantite}</td>
                            <td>${sale.emplacement}</td>
                            <td>${new Date(sale.date).toLocaleString()}</td>
                            <td>${sale.demandeur}</td>
                        </tr>`
                    );
                });
            }
            $('#salesModal').show();  // Show the modal
        }).fail(function(xhr, status, error) {
            console.error("AJAX Error:", status, error);  // Log any AJAX errors
        });
    });

    $('.close-button').on('click', function() {
        $('#salesModal').hide();  // Hide the modal
    });
});


</script>

<li id="pending-arrivals-item" style="cursor: pointer;background-color: #c598a0;">
    <i class='bx bxs-archive-in'></i>
    <span class="text">
        <h3 id="total-arrivals-amount" class="arrivals-count">{{count_ventes_attente_arrive}}</h3>
        <p>Articles en attente d'arrivée</p>
    </span>
</li>

<li id="pending-shipments-item" style="cursor: pointer;background-color: #edf7b6;">
    <i class='bx bxs-archive-out'></i>
    <span class="text">
        <h3 id="total-shipments-amount" class="shipments-count">{{count_ventes_attente_expedition}}</h3>
        <p>Ventes en attente d'expédition</p>
    </span>
</li>


            </ul>





<!-- Modal pour Demande de Vente -->
<div id="addDemandeVente" style="display:none;">
    <div class="modal-content">
        <h2>Demande de Vente</h2>
        <form id="add-article-form" action="/add_inventaire" method="POST">
            <div class="form-group">
                <label for="code_article_vente">Code Article:</label>
                <input type="text" id="code_article_vente" name="code_article" list="codes_articles_vente" oninput="fillLibelleArticleVente(this, 'libelle_article_vente')" required>
                <datalist id="codes_articles_vente"></datalist>
            </div>
            <div class="form-group">
                <label for="libelle_article_vente">Libellé Article:</label>
                <input type="text" id="libelle_article_vente" name="libelle_article" required>
            </div>
            <div class="form-group">
                <label for="quantite_vente">Quantité:</label>
                <input type="number" id="quantite_vente" name="quantite" required>
            </div>
            <div class="form-group">
                <label for="vers_vente">Vers :</label>
                <input type="text" id="vers_vente" name="vers" list="usines_datalist" oninput="fetchUsines(this.value, 'usines_datalist')" required>
                <datalist id="usines_datalist"></datalist>
            </div>
            <div class="form-group">
                <label for="commande_vente">Commande:</label>
                <input type="text" id="commande_vente" name="commande" required>
            </div>
            <button type="submit" class="submit-button">Valider</button>
        </form>
    </div>
</div>

<script>
    async function fetchUsines(inputValue, datalistId) {
        try {
            const response = await fetch(`/fetch_usines?input=${inputValue}`);
            const usines = await response.json();

            const datalist = document.getElementById(datalistId);
            datalist.innerHTML = ''; // Effacer les options précédentes

            usines.forEach(usine => {
                const option = document.createElement('option');
                option.value = usine.nom_usine; // Nom de l'usine pour l'input
                option.setAttribute('data-region', usine.region); // Région en tant qu'attribut
                datalist.appendChild(option);
            });
        } catch (error) {
            console.error('Erreur lors du chargement des usines:', error);
        }
    }

    // Appel à la fonction fetchUsines lorsque l'utilisateur tape dans l'input
    document.getElementById('vers_vente').addEventListener('input', function() {
        const inputValue = this.value;
        fetchUsines(inputValue, 'usines_datalist');
    });
    async function fetchCodesVente(inputValue, datalistId) {
        try {
            const response = await fetch(`/fetch_codes_articles?input=${inputValue}`);
            const articles = await response.json();

            const datalist = document.getElementById(datalistId);
            datalist.innerHTML = ''; // Effacer les options précédentes

            articles.forEach(article => {
                const option = document.createElement('option');
                option.value = article.code_article; // Code article pour l'input
                option.setAttribute('data-libelle', article.libelle_article); // Libellé en tant qu'attribut
                datalist.appendChild(option);
            });
        } catch (error) {
            console.error('Erreur lors du chargement des codes articles:', error);
        }
    }

    // Appel à la fonction fetchCodesVente lorsque l'utilisateur tape dans l'input
    document.getElementById('code_article_vente').addEventListener('input', function() {
        const inputValue = this.value;
        fetchCodesVente(inputValue, 'codes_articles_vente');
    });

    // Fonction pour remplir le libellé en fonction de la sélection dans demande de vente
    function fillLibelleArticleVente(inputElement, libelleInputId) {
        const selectedOption = inputElement.value;
        const datalist = document.getElementById(inputElement.getAttribute('list'));

        // Trouver l'option correspondante dans la datalist
        for (let option of datalist.options) {
            if (option.value === selectedOption) {
                document.getElementById(libelleInputId).value = option.getAttribute('data-libelle'); // Remplir le libellé
                return;
            }
        }

        // Si aucune option n'est trouvée, vider le libellé
        document.getElementById(libelleInputId).value = '';
    }
</script>





<!-- Modal pour Demande d'Achat -->
<div id="addDemandeAchat" style="display:none;">
    <div class="modal-content">
        <h2>Demande d'Achat</h2>
        <form id="add-article-form" action="/add_demande_achat" method="POST">
            <div class="form-group">
                <label for="code_article_achat">Code Article:</label>
                <input type="text" id="code_article_achat" name="code_article" list="codes_articles_achat" oninput="fillLibelleArticle(this, 'libelle_article_achat')" required>
                <datalist id="codes_articles_achat"></datalist>
            </div>
            <div class="form-group">
                <label for="libelle_article_achat">Libellé Article:</label>
                <input type="text" id="libelle_article_achat" name="libelle_article" required>
            </div>
            <div class="form-group">
                <label for="quantite_achat">Quantité:</label>
                <input type="number" id="quantite_achat" name="quantite" required>
            </div>
            <button type="submit" class="submit-button">Valider</button>
        </form>
    </div>
</div>

<script>
    async function fetchCodes(inputValue, datalistId) {
        try {
            const response = await fetch(`/fetch_codes_articles?input=${inputValue}`);
            const articles = await response.json();

            const datalist = document.getElementById(datalistId);
            datalist.innerHTML = ''; // Effacer les options précédentes

            articles.forEach(article => {
                const option = document.createElement('option');
                option.value = article.code_article; // Code article pour l'input
                option.setAttribute('data-libelle', article.libelle_article); // Libellé en tant qu'attribut
                datalist.appendChild(option);
            });
        } catch (error) {
            console.error('Erreur lors du chargement des codes articles:', error);
        }
    }

    // Appel à la fonction fetchCodes lorsque l'utilisateur tape dans l'input
    document.getElementById('code_article_achat').addEventListener('input', function() {
        const inputValue = this.value;
        fetchCodes(inputValue, 'codes_articles_achat');
    });

    // Fonction pour remplir le libellé en fonction de la sélection
    function fillLibelleArticle(inputElement, libelleInputId) {
        const selectedOption = inputElement.value;
        const datalist = document.getElementById(inputElement.getAttribute('list'));

        // Trouver l'option correspondante dans la datalist
        for (let option of datalist.options) {
            if (option.value === selectedOption) {
                document.getElementById(libelleInputId).value = option.getAttribute('data-libelle'); // Remplir le libellé
                return;
            }
        }

        // Si aucune option n'est trouvée, vider le libellé
        document.getElementById(libelleInputId).value = '';
    }
</script>





<style>
    /* Styles globaux pour les modals */
.modal-content {
    background-color: #ffffff;
    border-radius: 8px;
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    padding: 20px;
    max-width: 500px;
    margin: auto;
    position: relative;
    animation: fadeIn 0.3s ease;
}

/* Styles pour le titre des modals */
.modal-content h2 {
    color: #333;
    font-size: 1.8em;
    margin-bottom: 20px;
    text-align: center;
}

/* Styles pour les groupes de formulaires */
.form-group {
    margin-bottom: 15px;
}

/* Styles pour les labels */
.form-group label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
    color: #555;
}

/* Styles pour les inputs */
.form-group input {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 1em;
    transition: border-color 0.3s;
}

/* Effet de focus sur les inputs */
.form-group input:focus {
    border-color: #007bff;
    outline: none;
}

/* Styles pour le bouton de soumission */
.submit-button {
    background-color: #007bff;
    color: #fff;
    padding: 10px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1em;
    transition: background-color 0.3s, transform 0.2s;
    width: 100%; /* Remplir toute la largeur */
}

/* Effet de survol sur le bouton */
.submit-button:hover {
    background-color: #0056b3;
    transform: scale(1.05);
}

/* Animation de fadeIn */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

</style>









<style>
    /* Style général pour le tableau */
#achatsTable {
    width: 100%; /* Prend toute la largeur */
    border-collapse: collapse; /* Évite les doubles bordures */
    margin: 20px 0; /* Espacement autour du tableau */
    font-family: Arial, sans-serif; /* Police de caractères */
}

/* Style pour l'en-tête du tableau */
#achatsTable thead {
    background-color: #4CAF50; /* Couleur de fond verte */
    color: white; /* Couleur du texte blanche */
}

#achatsTable th {
    padding: 12px; /* Espacement à l'intérieur des cellules */
    text-align: left; /* Alignement du texte à gauche */
}

/* Style pour le corps du tableau */
#achatsTable tbody tr {
    border-bottom: 1px solid #ddd; /* Bordure en bas des lignes */
}

#achatsTable td {
    padding: 12px; /* Espacement à l'intérieur des cellules */
    text-align: left; /* Alignement du texte à gauche */
}

/* Style pour les lignes de tableau au survol */
#achatsTable tbody tr:hover {
    background-color: #f5f5f5; /* Couleur de fond au survol */
}

/* Style pour les boutons */
#achatsTable button {
    background-color: #4CAF50; /* Couleur de fond verte */
    color: white; /* Couleur du texte blanche */
    border: none; /* Pas de bordure */
    padding: 10px 15px; /* Espacement à l'intérieur des boutons */
    cursor: pointer; /* Curseur en main */
    border-radius: 5px; /* Coins arrondis */
    transition: background-color 0.3s; /* Transition pour le survol */
}

/* Changement de couleur des boutons au survol */
#achatsTable button:hover {
    background-color: #45a049; /* Couleur plus foncée au survol */
}





/* Style général pour le tableau */
#ventesTable {
    width: 100%; /* Prend toute la largeur */
    border-collapse: collapse; /* Évite les doubles bordures */
    margin: 20px 0; /* Espacement autour du tableau */
    font-family: Arial, sans-serif; /* Police de caractères */
}

/* Style pour l'en-tête du tableau */
#ventesTable thead {
    background-color: #e45858; /* Couleur de fond verte */
    color: white; /* Couleur du texte blanche */
}

#ventesTable th {
    padding: 12px; /* Espacement à l'intérieur des cellules */
    text-align: left; /* Alignement du texte à gauche */
}

/* Style pour le corps du tableau */
#ventesTable tbody tr {
    border-bottom: 1px solid #ddd; /* Bordure en bas des lignes */
}

#ventesTable td {
    padding: 12px; /* Espacement à l'intérieur des cellules */
    text-align: left; /* Alignement du texte à gauche */
}

/* Style pour les lignes de tableau au survol */
#ventesTable tbody tr:hover {
    background-color: #f5f5f5; /* Couleur de fond au survol */
}

/* Style pour les boutons */
#ventesTable button {
    background-color: #e45858; /* Couleur de fond verte */
    color: white; /* Couleur du texte blanche */
    border: none; /* Pas de bordure */
    padding: 10px 15px; /* Espacement à l'intérieur des boutons */
    cursor: pointer; /* Curseur en main */
    border-radius: 5px; /* Coins arrondis */
    transition: background-color 0.3s; /* Transition pour le survol */
}

/* Changement de couleur des boutons au survol */
#ventesTable button:hover {
    background-color: #b83e3e; /* Couleur plus foncée au survol */
}

</style>



<h1>Confirmer l'Arrivée des Articles</h1>
<table id="achatsTable">
    <thead>
        <tr>
            <th>Code Demande</th>
            <th>Code Article</th>
            <th>Libellé Article</th>
            <th>Quantité</th>
            <th>Emplacement</th>
            <th>Date</th>
            <th>Fournisseur</th>
            <th>Prix Achat</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody >
        
        <!-- Les données seront ajoutées ici par JavaScript -->
    </tbody>
</table>

<script>
    // Fonction pour charger les demandes d'achat
    async function loadPurchaseDemands() {
        try {
            const response = await fetch('/buys_attentes_confirm');
            const demandes_achats = await response.json();

            const tableBody = document.getElementById('achatsTable').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = ''; // Effacer le contenu précédent

            demandes_achats.forEach(demande => {
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>${demande.code_demande}</td>
                    <td>${demande.code_article}</td>
                    <td>${demande.libelle_article}</td>
                    <td>${demande.quantite}</td>
                    <td>${demande.emplacement}</td>
                    <td>${new Date(demande.date).toLocaleString()}</td>
                    <td>${demande.fournisseur}</td>
                    <td>${demande.prix_achat}</td>
                    <td><button id="btn-confirmer-arriver" onclick="confirmArrival(${demande.code_demande})">Confirmer l'arrivée</button></td>
                `;
            });
        } catch (error) {
            console.error('Erreur lors du chargement des demandes d\'achat:', error);
        }
    }

    // Fonction pour confirmer l'arrivée d'un achat
    async function confirmArrival(code_demande) {
        const confirmation = confirm("Êtes-vous sûr de vouloir confirmer l'arrivée de cet achat ?");
        if (confirmation) {
            try {
                const response = await fetch(`/confirm_arriver/${code_demande}`, { method: 'POST' });
                if (response.ok) {
                    alert('Arrivée confirmée avec succès.');
                    loadPurchaseDemands(); // Recharger les demandes après confirmation
                }

            } catch (error) {
                console.error('Erreur lors de la confirmation de l\'arrivée:   2222222222222222222222', error);
            }
        }
    }

    // Charger les demandes d'achat lors du chargement de la page
        window.onload = loadPurchaseDemands();    
</script>







    <h1>Confirmer Expédition de Ventes</h1>


    <table id="ventesTable">
        <thead>
            <tr>
                <th>Code Demande</th>
                <th>Code Article</th>
                <th>Libellé Article</th>
                <th>Quantité</th>
                <th>Emplacement</th>
                <th>Date</th>
                <th>Demandeur</th>
                <th>Vers</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <!-- Les données seront ajoutées ici par JavaScript -->
        </tbody>
    </table>
    
    <script>
        // Fonction pour charger les demandes de vente
        async function loadSalesDemands() {
            try {
                const response = await fetch('/sales_attentes_confirm');
                const demandes_sales = await response.json();
    
                const tableBody = document.getElementById('ventesTable').getElementsByTagName('tbody')[0];
                tableBody.innerHTML = ''; // Effacer le contenu précédent
    
                demandes_sales.forEach(demande => {
                    const row = tableBody.insertRow();
                    row.innerHTML = `
                        <td>${demande.code_demande}</td>
                        <td>${demande.code_article}</td>
                        <td>${demande.libelle_article}</td>
                        <td>${demande.quantite}</td>
                        <td>${demande.emplacement}</td>
                        <td>${new Date(demande.date).toLocaleString()}</td>
                        <td>${demande.demandeur}</td>
                        <td>${demande.vers}</td>
                        <td><button id="btn-confirmer-vente" onclick="confirmVente(${demande.code_demande})">Confirmer la vente</button></td>
                    `;
                });
            } catch (error) {
                console.error('Erreur lors du chargement des demandes de vente:', error);
            }
        }
    
        // Fonction pour confirmer l'arrivée d'une vente
        async function confirmVente(code_demande) {
            const confirmation = confirm("Êtes-vous sûr de vouloir confirmer l'expédition de cette vente ?");
            if (confirmation) {
                try {
                    const response = await fetch(`/confirm_vente/${code_demande}`, { method: 'POST' });
                    if (response.ok) {
                        alert('Vente confirmée avec succès.');
                        loadSalesDemands(); // Recharger les demandes après confirmation
                    } else {
                        alert('Erreur lors de la confirmation de la vente.');
                    }
                } catch (error) {
                    console.error('Erreur lors de la confirmation de la vente:', error);
                }
            }
        }
    
        // Charger les demandes de vente lors du chargement de la page
        window.onload = loadSalesDemands;
    </script>
    



<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Obtenez les éléments du menu
        const addDemandeAchat = document.getElementById('add-demande_achat');
        const addDemandeVente = document.getElementById('add-demande_vente');
    
        // Obtenez les modals
        const modalAchat = document.getElementById('addDemandeAchat');
        const modalVente = document.getElementById('addDemandeVente');
    
        // Événements de clic pour la demande d'achat
        addDemandeAchat.addEventListener('click', function () {
            modalAchat.style.display = 'block'; // Affiche le modal d'achat
            modalVente.style.display = 'none'; // Cache le modal de vente
        });
    
        // Événements de clic pour la demande de vente
        addDemandeVente.addEventListener('click', function () {
            modalVente.style.display = 'block'; // Affiche le modal de vente
            modalAchat.style.display = 'none'; // Cache le modal d'achat
        });
    
        // Fermer le modal lorsqu'on clique en dehors du modal (optionnel)
        window.addEventListener('click', function (event) {
            if (event.target === modalAchat || event.target === modalVente) {
                modalAchat.style.display = 'none';
                modalVente.style.display = 'none';
            }
        });
    });
    </script>
    

  
    <div class="table-data" >
        <div class="order">
            <div class="head" >
                <h3>Articles Recents</h3>
                <button id="export-options-btn">Exporter</button>
                <div id="export-options" name="export-options" style="display: none;">
                    <button id="export-recent-excel-btn">Exporter en Excel</button>
                    <button id="print-recent-btn">Imprimer</button>
                </div>
                
                <!-- Icone de filtre -->
            </div>
         
            <table style="background-color: #b5d3df;" >
                <thead >
                    <tr >
                        <th style="background-color: #e3ee7b;text-align:center;">Lots</th>
                        <th style="background-color: #bbe4ee;text-align:center;">Code Article</th>
                        <th style="background-color: #b7dfb5;text-align:center;">Libelle Article</th> <!-- Change from User to Libelle Article -->
                        <th style="background-color: #d6c1d4;text-align:center;">Date Order</th>
                        <th style="background-color: #cea8c1;text-align:center;">Assignation</th>
                        <th style="background-color: #d7dfb5;text-align:center;">Quantité</th>
                        <th style="background-color: #dfc1b5;text-align:center;">Fournisseur</th>
                    </tr>
                </thead>
                <tbody id="recent-orders-body">
                    <!-- The recent orders will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    
        
        
        
        <script>
        $(document).ready(function() {
            // Fetch recent orders when the page loads
            function fetchRecentOrders() {
                $.get('/recent_orders', function(data) {
                    let ordersBody = $('#recent-orders-body');
                    ordersBody.empty();  // Clear any previous entries
        
                    // Loop through the orders and append rows to the table
                    data.forEach(function(order) {
                        ordersBody.append(`
                            <tr>
                                <td style="background-color: #e3ee8b; text-align:center;">${order.id_article}</td>
                                <td style="background-color: #dbe4fe; text-align:center;">${order.code_article}</td>
                                <td style="background-color: #b7df90; text-align:center;">${order.libelle_article}</td>  <!-- Display libelle article -->
                                <td style="background-color: #d6c1c4;text-align:center;">${order.date_order}</td>
                                <td style="background-color: #cea8b1;text-align:center;">${order.emplacement}</td>
                                <td style="background-color: #d7dfa5;text-align:center;">${order.quantite}</td>
                                <td style="background-color: #dfc1b5;text-align:center;">${order.fournisseur}</td>
                            </tr>
                        `);
                    });
                }).fail(function(xhr, status, error) {
                    console.error("Error fetching recent orders:", status, error);
                });
            }
        
            // Call the function to fetch and display recent orders
            fetchRecentOrders();
        
            // Afficher ou masquer les options d'exportation
            $('#export-options-btn').click(function() {
                $('#export-options').toggle();
            });
        
            // Fonction pour exporter les résultats en fichier Excel
            document.getElementById("export-recent-excel-btn").onclick = function() {
                var table = document.getElementById("recent-orders-body").parentElement;
                var rows = Array.from(table.querySelectorAll('tr'));
        
                // Créer une feuille de calcul Excel
                var workbook = XLSX.utils.book_new();
                var worksheet_data = [];
        
                // Extraire les en-têtes du tableau (th)
                var headers = Array.from(table.querySelectorAll('th')).map(header => header.textContent.trim());
                worksheet_data.push(headers);
        
                // Extraire les données du tableau (td)
                rows.forEach(row => {
                    var rowData = Array.from(row.querySelectorAll('td')).map(cell => cell.textContent.trim());
                    worksheet_data.push(rowData);
                });
        
                // Créer une feuille dans le workbook avec les données du tableau
                var worksheet = XLSX.utils.aoa_to_sheet(worksheet_data);
                XLSX.utils.book_append_sheet(workbook, worksheet, "Articles Recents");
        
                // Exporter le fichier Excel
                XLSX.writeFile(workbook, 'articles_recents.xlsx');
            };
        
            // Fonction pour imprimer le tableau des articles récents
            document.getElementById("print-recent-btn").onclick = function() {
                var table = document.getElementById("recent-orders-body").parentElement.outerHTML;
        
                // Ouvrir une nouvelle fenêtre pour l'impression
                var printWindow = window.open('', '', 'width=800,height=600');
                printWindow.document.write('<html><head><title>Imprimer les Articles Recents</title>');
                printWindow.document.write('<style>table { width: 100%; border-collapse: collapse; } th, td { border: 1px solid black; padding: 8px; text-align: center; } </style>');
                printWindow.document.write('</head><body>');
                printWindow.document.write(table); // Insérer le tableau dans la fenêtre
                printWindow.document.write('</body></html>');
                printWindow.document.close();
                printWindow.focus();
                printWindow.print(); // Ouvrir la boîte de dialogue d'impression
                printWindow.close(); // Fermer la fenêtre après impression
            };
        
        });
        </script>
        
            
                
        
                    </div>
                    <div class="table-data">
                        <div class="order">
                            <div class="head">
                                <h3>Fournisseurs</h3>
                                <button id="export-fournisseurs-btn">Exporter</button>
                                <div id="export-options-fournisseurs" style="display: none;">
                                    <button id="export-fournisseurs-excel-btn">Exporter en Excel</button>
                                    <button id="print-fournisseurs-btn">Imprimer</button>
                                </div>
                            </div>
                            <table style="background-color: #b5d3df;">
                                <thead>
                                    <tr>
                                        <th style="background-color: #e3ee7b; text-align:center;">Nom Fournisseur</th>
                                        <th style="background-color: #bbe4ee; text-align:center;">Matricule Fiscale</th>
                                        <th style="background-color: #b7dfb5; text-align:center;">Adresse</th>
                                        <th style="background-color: #d6c1d4; text-align:center;">Téléphone</th>
                                    </tr>
                                </thead>
                                <tbody id="fournisseurs-body">
                                    <!-- Les fournisseurs seront affichés ici -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <script>
                        $(document).ready(function() {
            // Fetch fournisseurs
            function fetchFournisseurs() {
                $.get('/fournisseurs', function(data) {
                    let fournisseursBody = $('#fournisseurs-body');
                    fournisseursBody.empty();  // Clear previous entries
        
                    // Populate the table with data
                    data.forEach(function(fournisseur) {
                        fournisseursBody.append(`
                            <tr>
                                <td style="background-color: #e3ee8b; text-align:center;">${fournisseur.nom_fournisseur}</td>
                                <td style="background-color: #dbe4fe; text-align:center;">${fournisseur.matricule_fiscale}</td>
                                <td style="background-color: #b7df90; text-align:center;">${fournisseur.addresse}</td>
                                <td style="background-color: #d6c1c4;text-align:center;">${fournisseur.telephone}</td>
                            </tr>
                        `);
                    });
                }).fail(function(xhr, status, error) {
                    console.error("Error fetching fournisseurs:", status, error);
                });
            }
        
            // Call the function to fetch and display fournisseurs
            fetchFournisseurs();
        
            // Toggle export options visibility
            $('#export-fournisseurs-btn').click(function() {
                $('#export-options-fournisseurs').toggle();
            });
        
            // Export to Excel functionality
            $('#export-fournisseurs-excel-btn').click(function() {
                var table = document.getElementById("fournisseurs-body").parentElement;
                var rows = Array.from(table.querySelectorAll('tr'));
        
                // Create Excel workbook
                var workbook = XLSX.utils.book_new();
                var worksheet_data = [];
        
                // Extract headers
                var headers = Array.from(table.querySelectorAll('th')).map(header => header.textContent.trim());
                worksheet_data.push(headers);
        
                // Extract row data
                rows.forEach(row => {
                    var rowData = Array.from(row.querySelectorAll('td')).map(cell => cell.textContent.trim());
                    worksheet_data.push(rowData);
                });
        
                // Create worksheet and append it to the workbook
                var worksheet = XLSX.utils.aoa_to_sheet(worksheet_data);
                XLSX.utils.book_append_sheet(workbook, worksheet, "Fournisseurs");
        
                // Export Excel file
                XLSX.writeFile(workbook, 'fournisseurs.xlsx');
            });
        
            // Print functionality
            $('#print-fournisseurs-btn').click(function() {
                var table = document.getElementById("fournisseurs-body").parentElement.outerHTML;
        
                // Open new window for printing
                var printWindow = window.open('', '', 'width=800,height=600');
                printWindow.document.write('<html><head><title>Imprimer les Fournisseurs</title>');
                printWindow.document.write('<style>table { width: 100%; border-collapse: collapse; } th, td { border: 1px solid black; padding: 8px; text-align: center; } </style>');
                printWindow.document.write('</head><body>');
                printWindow.document.write(table);  // Insert the table for printing
                printWindow.document.write('</body></html>');
                printWindow.document.close();
                printWindow.focus();
                printWindow.print();
                printWindow.close();
            });
        });
        
                    </script>
        <div class="table-data">
            <div class="order">
                <div class="head">
                    <h3>Ventes Récentes</h3>
                    <button id="export-options-sales-btn">Exporter</button>
                    <div id="export-options-sales" style="display: none;">
                        <button id="export-recent-excel-btn">Exporter en Excel</button>
                        <button id="print-recent-btn">Imprimer</button>
                    </div>
                </div>
        
                <table style="background-color: #b5d3df;">
                    <thead>
                        <tr>
                            <th style="background-color: #e3ee7b;text-align:center;">Code Demande</th>
                            <th style="background-color: #bbe4ee;text-align:center;">Code Article</th>
                            <th style="background-color: #b7dfb5;text-align:center;">Libellé Article</th>
                            <th style="background-color: #d6c1d4;text-align:center;">Quantité</th>
                            <th style="background-color: #cea8c1;text-align:center;">Prix Vente</th>
                            <th style="background-color: #d7dfb5;text-align:center;">Emplacement</th>
                            <th style="background-color: #d7d1a5;text-align:center;">Demandeur</th>
                            <th style="background-color: #d6c1a1;text-align:center;">Vers</th>
                            <th style="background-color: #dfc1b5;text-align:center;">Date</th>
                        </tr>
                    </thead>
                    <tbody id="recent-sales-body">
                        <!-- Les ventes récentes seront chargées ici -->
                    </tbody>
                </table>
            </div>
        </div>
        

    
    <script>
    $(document).ready(function() {
        // Fetch recent orders when the page loads
        function fetchRecentOrders() {
            $.get('/recent_orders', function(data) {
                let ordersBody = $('#recent-orders-body');
                ordersBody.empty();  // Clear any previous entries
    
                // Loop through the orders and append rows to the table
                data.forEach(function(order) {
                    ordersBody.append(`
                        <tr>
                            <td style="background-color: #e3ee8b; text-align:center;">${order.id_article}</td>
                            <td style="background-color: #dbe4fe; text-align:center;">${order.code_article}</td>
                            <td style="background-color: #b7df90; text-align:center;">${order.libelle_article}</td>  <!-- Display libelle article -->
                            <td style="background-color: #d6c1c4;text-align:center;">${order.date_order}</td>
                            <td style="background-color: #cea8b1;text-align:center;">${order.emplacement}</td>
                            <td style="background-color: #d7dfa5;text-align:center;">${order.quantite}</td>
                            <td style="background-color: #dfc1b5;text-align:center;">${order.fournisseur}</td>
                        </tr>
                    `);
                });
            }).fail(function(xhr, status, error) {
                console.error("Error fetching recent orders:", status, error);
            });
        }
    
        // Call the function to fetch and display recent orders
        fetchRecentOrders();
    
        // Afficher ou masquer les options d'exportation
        $('#export-options-btn').click(function() {
            $('#export-options').toggle();
        });
    
        // Fonction pour exporter les résultats en fichier Excel
        document.getElementById("export-recent-excel-btn").onclick = function() {
            var table = document.getElementById("recent-orders-body").parentElement;
            var rows = Array.from(table.querySelectorAll('tr'));
    
            // Créer une feuille de calcul Excel
            var workbook = XLSX.utils.book_new();
            var worksheet_data = [];
    
            // Extraire les en-têtes du tableau (th)
            var headers = Array.from(table.querySelectorAll('th')).map(header => header.textContent.trim());
            worksheet_data.push(headers);
    
            // Extraire les données du tableau (td)
            rows.forEach(row => {
                var rowData = Array.from(row.querySelectorAll('td')).map(cell => cell.textContent.trim());
                worksheet_data.push(rowData);
            });
    
            // Créer une feuille dans le workbook avec les données du tableau
            var worksheet = XLSX.utils.aoa_to_sheet(worksheet_data);
            XLSX.utils.book_append_sheet(workbook, worksheet, "Articles Recents");
    
            // Exporter le fichier Excel
            XLSX.writeFile(workbook, 'articles_recents.xlsx');
        };
    
        // Fonction pour imprimer le tableau des articles récents
        document.getElementById("print-recent-btn").onclick = function() {
            var table = document.getElementById("recent-orders-body").parentElement.outerHTML;
    
            // Ouvrir une nouvelle fenêtre pour l'impression
            var printWindow = window.open('', '', 'width=800,height=600');
            printWindow.document.write('<html><head><title>Imprimer les Articles Recents</title>');
            printWindow.document.write('<style>table { width: 100%; border-collapse: collapse; } th, td { border: 1px solid black; padding: 8px; text-align: center; } </style>');
            printWindow.document.write('</head><body>');
            printWindow.document.write(table); // Insérer le tableau dans la fenêtre
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.focus();
            printWindow.print(); // Ouvrir la boîte de dialogue d'impression
            printWindow.close(); // Fermer la fenêtre après impression
        };
    
    });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <style>
        /* Style spécifique pour le tableau de réception d'achats */
#demandes-achat-table {
  width: 100%;
  border-collapse: collapse;
  margin: 20px 0;
  font-size: 16px;
  text-align: left;
  box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);
}

#demandes-achat-table thead tr {
  background-color: #009879;
  color: white;
  font-weight: bold;
}

#demandes-achat-table th,
#demandes-achat-table td {
  padding: 12px 15px;
  border: 1px solid #ddd;
}

#demandes-achat-table tbody tr {
  background-color: #f9f9f9;
}

#demandes-achat-table tbody tr:nth-child(even) {
  background-color: #f3f3f3;
}

#demandes-achat-table tbody tr:hover {
  background-color: #f1f1f1;
}

#demandes-achat-table td button {
  background-color: #0c2b25;
  color: white;
  border: none;
  padding: 8px 12px;
  cursor: pointer;
  border-radius: 4px;
  transition: background-color 0.3s ease;
}

#demandes-achat-table td button:hover {
  background-color: #00c09a;
}

/* Responsive design */
@media (max-width: 768px) {
  #demandes-achat-table {
    font-size: 14px;
  }

  #demandes-achat-table thead {
    display: none;
  }

  #demandes-achat-table tbody tr {
    display: block;
    margin-bottom: 15px;
  }

  #demandes-achat-table tbody tr td {
    display: block;
    text-align: right;
    padding-left: 50%;
    position: relative;
  }

  #demandes-achat-table tbody tr td:before {
    content: attr(data-label);
    position: absolute;
    left: 0;
    width: 50%;
    padding-left: 15px;
    font-weight: bold;
    text-align: left;
    color: #333;
  }
}

    </style>

<style>
    /* Style spécifique pour le tableau de confirmation des ventes */
    #demandes-ventes-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 16px;
      text-align: left;
      box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);
    }

    #demandes-ventes-table thead tr {
      background-color: #d9534f; /* Couleur rouge pour vente */
      color: white;
      font-weight: bold;
    }

    #demandes-ventes-table th,
    #demandes-ventes-table td {
      padding: 12px 15px;
      border: 1px solid #ddd;
    }

    #demandes-ventes-table tbody tr {
      background-color: #f9f9f9;
    }

    #demandes-ventes-table tbody tr:nth-child(even) {
      background-color: #f3f3f3;
    }

    #demandes-ventes-table tbody tr:hover {
      background-color: #f1f1f1;
    }

    #demandes-ventes-table td button {
      background-color: #c9302c; /* Rouge plus foncé pour le bouton */
      color: white;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      border-radius: 4px;
      transition: background-color 0.3s ease;
    }

    #demandes-ventes-table td button:hover {
      background-color: #d9534f; /* Rouge vif au survol */
    }

    /* Responsive design */
    @media (max-width: 768px) {
      #demandes-ventes-table {
        font-size: 14px;
      }

      #demandes-ventes-table thead {
        display: none;
      }

      #demandes-ventes-table tbody tr {
        display: block;
        margin-bottom: 15px;
      }

      #demandes-ventes-table tbody tr td {
        display: block;
        text-align: right;
        padding-left: 50%;
        position: relative;
      }

      #demandes-ventes-table tbody tr td:before {
        content: attr(data-label);
        position: absolute;
        left: 0;
        width: 50%;
        padding-left: 15px;
        font-weight: bold;
        text-align: left;
        color: #333;
      }
    }
</style>
 
    
                </div>
		</main>
		<!-- MAIN -->
	</section>
	<!-- CONTENT -->
	




    
	<script src="script.js"></script>
</body>
</html>
<style>
	@import url('https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Poppins:wght@400;500;600;700&display=swap');

* {
	margin: 0;
	padding: 0;
	box-sizing: border-box;
}

a {
	text-decoration: none;
}

li {
	list-style: none;
}

:root {
	--poppins: 'Poppins', sans-serif;
	--lato: 'Lato', sans-serif;

	--light: #F9F9F9;
	--blue: #3C91E6;
	--light-blue: #CFE8FF;
	--grey: #eee;
	--dark-grey: #AAAAAA;
	--dark: #342E37;
	--red: #DB504A;
	--yellow: #FFCE26;
	--light-yellow: #FFF2C6;
	--orange: #FD7238;
	--light-orange: #FFE0D3;
}

html {
	overflow-x: hidden;
}

body.dark {
	--light: #0C0C1E;
	--grey: #060714;
	--dark: #FBFBFB;
}

body {
	background: var(--grey);
	overflow-x: hidden;
}





/* SIDEBAR */
#sidebar {
	position: fixed;
	top: 0;
	left: 0;
	width: 280px;
	height: 100%;
	background: var(--light);
	z-index: 2000;
	font-family: var(--lato);
	transition: .3s ease;
	overflow-x: hidden;
	scrollbar-width: none;
}
#sidebar::--webkit-scrollbar {
	display: none;
}
#sidebar.hide {
	width: 60px;
}
#sidebar .brand {
	font-size: 24px;
	font-weight: 700;
	height: 56px;
	display: flex;
	align-items: center;
	color: var(--blue);
	position: sticky;
	top: 0;
	left: 0;
	background: var(--light);
	z-index: 500;
	padding-bottom: 20px;
	box-sizing: content-box;
}
#sidebar .brand .bx {
	min-width: 60px;
	display: flex;
	justify-content: center;
}
#sidebar .side-menu {
	width: 100%;
	margin-top: 48px;
}
#sidebar .side-menu li {
	height: 48px;
	background: transparent;
	margin-left: 6px;
	border-radius: 48px 0 0 48px;
	padding: 4px;
}
#sidebar .side-menu li.active {
	background: var(--grey);
	position: relative;
}
#sidebar .side-menu li.active::before {
	content: '';
	position: absolute;
	width: 40px;
	height: 40px;
	border-radius: 50%;
	top: -40px;
	right: 0;
	box-shadow: 20px 20px 0 var(--grey);
	z-index: -1;
}
#sidebar .side-menu li.active::after {
	content: '';
	position: absolute;
	width: 40px;
	height: 40px;
	border-radius: 50%;
	bottom: -40px;
	right: 0;
	box-shadow: 20px -20px 0 var(--grey);
	z-index: -1;
}
#sidebar .side-menu li a {
	width: 100%;
	height: 100%;
	background: var(--light);
	display: flex;
	align-items: center;
	border-radius: 48px;
	font-size: 16px;
	color: var(--dark);
	white-space: nowrap;
	overflow-x: hidden;
}
#sidebar .side-menu.top li.active a {
	color: var(--blue);
}
#sidebar.hide .side-menu li a {
	width: calc(48px - (4px * 2));
	transition: width .3s ease;
}
#sidebar .side-menu li a.logout {
	color: var(--red);
}
#sidebar .side-menu.top li a:hover {
	color: var(--blue);
}
#sidebar .side-menu li a .bx {
	min-width: calc(60px  - ((4px + 6px) * 2));
	display: flex;
	justify-content: center;
}
/* SIDEBAR */





/* CONTENT */
#content {
	position: relative;
	width: calc(100% - 280px);
	left: 280px;
	transition: .3s ease;
}
#sidebar.hide ~ #content {
	width: calc(100% - 60px);
	left: 60px;
}




/* NAVBAR */
#content nav {
	height: 56px;
	background: var(--light);
	padding: 0 24px;
	display: flex;
	align-items: center;
	grid-gap: 24px;
	font-family: var(--lato);
	position: sticky;
	top: 0;
	left: 0;
	z-index: 1000;
}
#content nav::before {
	content: '';
	position: absolute;
	width: 40px;
	height: 40px;
	bottom: -40px;
	left: 0;
	border-radius: 50%;
	box-shadow: -20px -20px 0 var(--light);
}
#content nav a {
	color: var(--dark);
}
#content nav .bx.bx-menu {
	cursor: pointer;
	color: var(--dark);
}
#content nav .nav-link {
	font-size: 16px;
	transition: .3s ease;
}
#content nav .nav-link:hover {
	color: var(--blue);
}
#content nav form {
	max-width: 400px;
	width: 100%;
	margin-right: auto;
}
#content nav form .form-input {
	display: flex;
	align-items: center;
	height: 36px;
}
#content nav form .form-input input {
	flex-grow: 1;
	padding: 0 16px;
	height: 100%;
	border: none;
	background: var(--grey);
	border-radius: 36px 0 0 36px;
	outline: none;
	width: 100%;
	color: var(--dark);
}
#content nav form .form-input button {
	width: 36px;
	height: 100%;
	display: flex;
	justify-content: center;
	align-items: center;
	background: var(--blue);
	color: var(--light);
	font-size: 18px;
	border: none;
	outline: none;
	border-radius: 0 36px 36px 0;
	cursor: pointer;
}
#content nav .notification {
	font-size: 20px;
	position: relative;
}
#content nav .notification .num {
	position: absolute;
	top: -6px;
	right: -6px;
	width: 20px;
	height: 20px;
	border-radius: 50%;
	border: 2px solid var(--light);
	background: var(--red);
	color: var(--light);
	font-weight: 700;
	font-size: 12px;
	display: flex;
	justify-content: center;
	align-items: center;
}
#content nav .profile img {
	width: 36px;
	height: 36px;
	object-fit: cover;
	border-radius: 50%;
}
#content nav .switch-mode {
	display: block;
	min-width: 50px;
	height: 25px;
	border-radius: 25px;
	background: var(--grey);
	cursor: pointer;
	position: relative;
}
#content nav .switch-mode::before {
	content: '';
	position: absolute;
	top: 2px;
	left: 2px;
	bottom: 2px;
	width: calc(25px - 4px);
	background: var(--blue);
	border-radius: 50%;
	transition: all .3s ease;
}
#content nav #switch-mode:checked + .switch-mode::before {
	left: calc(100% - (25px - 4px) - 2px);
}
/* NAVBAR */





/* MAIN */
#content main {
	width: 100%;
	padding: 36px 24px;
	font-family: var(--poppins);
	max-height: calc(100vh - 56px);
	overflow-y: auto;
}
#content main .head-title {
	display: flex;
	align-items: center;
	justify-content: space-between;
	grid-gap: 16px;
	flex-wrap: wrap;
}
#content main .head-title .left h1 {
	font-size: 36px;
	font-weight: 600;
	margin-bottom: 10px;
	color: var(--dark);
}
#content main .head-title .left .breadcrumb {
	display: flex;
	align-items: center;
	grid-gap: 16px;
}
#content main .head-title .left .breadcrumb li {
	color: var(--dark);
}
#content main .head-title .left .breadcrumb li a {
	color: var(--dark-grey);
	pointer-events: none;
}
#content main .head-title .left .breadcrumb li a.active {
	color: var(--blue);
	pointer-events: unset;
}
#content main .head-title .btn-download {
	height: 36px;
	padding: 0 16px;
	border-radius: 36px;
	background: var(--blue);
	color: var(--light);
	display: flex;
	justify-content: center;
	align-items: center;
	grid-gap: 10px;
	font-weight: 500;
}




#content main .box-info {
	display: grid;
	grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
	grid-gap: 24px;
	margin-top: 36px;
}
#content main .box-info li {
	padding: 24px;
	background: var(--light);
	border-radius: 20px;
	display: flex;
	align-items: center;
	grid-gap: 24px;
}
#content main .box-info li .bx {
	width: 80px;
	height: 80px;
	border-radius: 10px;
	font-size: 36px;
	display: flex;
	justify-content: center;
	align-items: center;
}
#content main .box-info li:nth-child(1) .bx {
	background: var(--light-blue);
	color: var(--blue);
}
#content main .box-info li:nth-child(2) .bx {
	background: var(--light-yellow);
	color: var(--yellow);
}
#content main .box-info li:nth-child(3) .bx {
	background: var(--light-orange);
	color: var(--orange);
}
#content main .box-info li .text h3 {
	font-size: 24px;
	font-weight: 600;
	color: var(--dark);
}
#content main .box-info li .text p {
	color: var(--dark);	
}





#content main .table-data {
	display: flex;
	flex-wrap: wrap;
	grid-gap: 24px;
	margin-top: 24px;
	width: 100%;
	color: var(--dark);
}
#content main .table-data > div {
	border-radius: 20px;
	background: var(--light);
	padding: 24px;
	overflow-x: auto;
}
#content main .table-data .head {
	display: flex;
	align-items: center;
	grid-gap: 16px;
	margin-bottom: 24px;
}
#content main .table-data .head h3 {
	margin-right: auto;
	font-size: 24px;
	font-weight: 600;
}
#content main .table-data .head .bx {
	cursor: pointer;
}

#content main .table-data .order {
	flex-grow: 1;
	flex-basis: 500px;
}
#content main .table-data .order table {
	width: 100%;
	border-collapse: collapse;
}
#content main .table-data .order table th {
	padding-bottom: 12px;
	font-size: 13px;
	text-align: left;
	border-bottom: 1px solid var(--grey);
}
#content main .table-data .order table td {
	padding: 16px 0;
}
#content main .table-data .order table tr td:first-child {
	display: flex;
	align-items: center;
	grid-gap: 12px;
	padding-left: 6px;
}
#content main .table-data .order table td img {
	width: 36px;
	height: 36px;
	border-radius: 50%;
	object-fit: cover;
}
#content main .table-data .order table tbody tr:hover {
	background: var(--grey);
}
#content main .table-data .order table tr td .status {
	font-size: 10px;
	padding: 6px 16px;
	color: var(--light);
	border-radius: 20px;
	font-weight: 700;
}
#content main .table-data .order table tr td .status.completed {
	background: var(--blue);
}
#content main .table-data .order table tr td .status.process {
	background: var(--yellow);
}
#content main .table-data .order table tr td .status.pending {
	background: var(--orange);
}


#content main .table-data .todo {
	flex-grow: 1;
	flex-basis: 300px;
}
#content main .table-data .todo .todo-list {
	width: 100%;
}
#content main .table-data .todo .todo-list li {
	width: 100%;
	margin-bottom: 16px;
	background: var(--grey);
	border-radius: 10px;
	padding: 14px 20px;
	display: flex;
	justify-content: space-between;
	align-items: center;
}
#content main .table-data .todo .todo-list li .bx {
	cursor: pointer;
}
#content main .table-data .todo .todo-list li.completed {
	border-left: 10px solid var(--blue);
}
#content main .table-data .todo .todo-list li.not-completed {
	border-left: 10px solid var(--orange);
}
#content main .table-data .todo .todo-list li:last-child {
	margin-bottom: 0;
}
/* MAIN */
/* CONTENT */









@media screen and (max-width: 768px) {
	#sidebar {
		width: 200px;
	}

	#content {
		width: calc(100% - 60px);
		left: 200px;
	}

	#content nav .nav-link {
		display: none;
	}
}






@media screen and (max-width: 576px) {
	#content nav form .form-input input {
		display: none;
	}

	#content nav form .form-input button {
		width: auto;
		height: auto;
		background: transparent;
		border-radius: none;
		color: var(--dark);
	}

	#content nav form.show .form-input input {
		display: block;
		width: 100%;
	}
	#content nav form.show .form-input button {
		width: 36px;
		height: 100%;
		border-radius: 0 36px 36px 0;
		color: var(--light);
		background: var(--red);
	}

	#content nav form.show ~ .notification,
	#content nav form.show ~ .profile {
		display: none;
	}

	#content main .box-info {
		grid-template-columns: 1fr;
	}

	#content main .table-data .head {
		min-width: 420px;
	}
	#content main .table-data .order table {
		min-width: 420px;
	}
	#content main .table-data .todo .todo-list {
		min-width: 420px;
	}
}
</style>
<script>
const allSideMenu = document.querySelectorAll('#sidebar .side-menu.top li a');

allSideMenu.forEach(item=> {
	const li = item.parentElement;

	item.addEventListener('click', function () {
		allSideMenu.forEach(i=> {
			i.parentElement.classList.remove('active');
		})
		li.classList.add('active');
	})
});




// TOGGLE SIDEBAR
const menuBar = document.querySelector('#content nav .bx.bx-menu');
const sidebar = document.getElementById('sidebar');

menuBar.addEventListener('click', function () {
	sidebar.classList.toggle('hide');
})







const searchButton = document.querySelector('#content nav form .form-input button');
const searchButtonIcon = document.querySelector('#content nav form .form-input button .bx');
const searchForm = document.querySelector('#content nav form');

searchButton.addEventListener('click', function (e) {
	if(window.innerWidth < 576) {
		e.preventDefault();
		searchForm.classList.toggle('show');
		if(searchForm.classList.contains('show')) {
			searchButtonIcon.classList.replace('bx-search', 'bx-x');
		} else {
			searchButtonIcon.classList.replace('bx-x', 'bx-search');
		}
	}
})





if(window.innerWidth < 768) {
	sidebar.classList.add('hide');
} else if(window.innerWidth > 576) {
	searchButtonIcon.classList.replace('bx-x', 'bx-search');
	searchForm.classList.remove('show');
}


window.addEventListener('resize', function () {
	if(this.innerWidth > 576) {
		searchButtonIcon.classList.replace('bx-x', 'bx-search');
		searchForm.classList.remove('show');
	}
})



const switchMode = document.getElementById('switch-mode');

switchMode.addEventListener('change', function () {
	if(this.checked) {
		document.body.classList.add('dark');
	} else {
		document.body.classList.remove('dark');
	}
})

</script>
<script>
    $(document).ready(function() {
// Fonction pour récupérer les ventes récentes
function fetchRecentSales() {
    $.get('/recent_sales', function(data) {
        let salesBody = $('#recent-sales-body');
        salesBody.empty();

        // Remplir le tableau avec les données des ventes récentes
        data.forEach(function(sale) {
            salesBody.append(`
                <tr>
                    <td style="background-color: #e3ee8b; text-align:center;">${sale.code_demande}</td>
                    <td style="background-color: #dbe4fe; text-align:center;">${sale.code_article}</td>
                    <td style="background-color: #b7df90; text-align:center;">${sale.libelle_article}</td>
                    <td style="background-color: #d6c1c4;text-align:center;">${sale.quantite}</td>
                    <td style="background-color: #cea8b1;text-align:center;">${sale.prix_vente}</td>
                    <td style="background-color: #d7dfa5;text-align:center;">${sale.emplacement}</td>
                    <td style="background-color: #d7d1a5;text-align:center;">${sale.demandeur}</td>
                    <td style="background-color: #d5c1b1;text-align:center;">${sale.vers}</td>
                    <td style="background-color: #dfc1b5;text-align:center;">${sale.date}</td>
                </tr>
            `);
        });
    }).fail(function(xhr, status, error) {
        console.error("Erreur lors de la récupération des ventes récentes:", status, error);
    });
}

// Appel de la fonction pour charger les ventes
fetchRecentSales();

// Afficher ou masquer les options d'exportation
$('#export-options-sales-btn').click(function() {
    $('#export-options-sales').toggle();
});

// Exporter les résultats en fichier Excel pour le tableau des ventes récentes
$('#export-recent-excel-btn').click(function() {
    var table = document.getElementById("recent-sales-body").parentElement;
    var rows = Array.from(table.querySelectorAll('tr'));

    var workbook = XLSX.utils.book_new();
    var worksheet_data = [];

    var headers = Array.from(table.querySelectorAll('th')).map(header => header.textContent.trim());
    worksheet_data.push(headers);

    rows.forEach(row => {
        var rowData = Array.from(row.querySelectorAll('td')).map(cell => cell.textContent.trim());
        worksheet_data.push(rowData);
    });

    var worksheet = XLSX.utils.aoa_to_sheet(worksheet_data);
    XLSX.utils.book_append_sheet(workbook, worksheet, "Ventes Récentes");
    XLSX.writeFile(workbook, 'ventes_recent.xlsx');
});

// Imprimer le tableau des ventes récentes
$('#print-recent-btn').click(function() {
    var table = document.getElementById("recent-sales-body").parentElement.outerHTML;

    var printWindow = window.open('', '', 'width=800,height=600');
    printWindow.document.write('<html><head><title>Imprimer les Ventes Récentes</title>');
    printWindow.document.write('<style>table { width: 100%; border-collapse: collapse; } th, td { border: 1px solid black; padding: 8px; text-align: center; }</style>');
    printWindow.document.write('</head><body>');
    printWindow.document.write(table);
    printWindow.document.write('</body></html>');
    printWindow.document.close();
    printWindow.focus();
    printWindow.print();
    printWindow.close();
});
});

</script>